
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          DOCDUCK FILE LIFECYCLE MANAGEMENT SYSTEM              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WHAT HAPPENS WHEN YOU RE-RUN THE INDEXER?                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

FILE STATES HANDLED:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… NEW FILE (in provider, not in database)
   â†’ Download â†’ Extract â†’ Chunk â†’ Embed â†’ INSERT to database
   â†’ Result: File indexed and searchable

âœ… UPDATED FILE (in both, but ETag changed)
   â†’ Download â†’ Extract â†’ Chunk â†’ Embed â†’ UPSERT to database
   â†’ Result: Old chunks replaced with new ones

âœ… UNCHANGED FILE (in both, same ETag)
   â†’ SKIP processing (logged)
   â†’ Result: Fast run, no wasted API calls

âœ… DELETED FILE (in database, not in provider)
   â†’ DELETE chunks from docs_chunks
   â†’ DELETE tracking from docs_files
   â†’ Result: Orphaned vectors removed (if cleanup enabled)

âœ… RENAMED FILE
   OneDrive/S3: Same doc_id â†’ treated as UPDATE
   Local: Different doc_id â†’ treated as DELETE + ADD


CONFIGURATION OPTIONS:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

appsettings.yaml:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Chunking:                                                      â”‚
â”‚   CleanupOrphanedDocuments: true   # Auto-remove deleted filesâ”‚
â”‚   ForceFullReindex: false          # Incremental by default   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

OPTION 1 - Normal Operation (Recommended):
   CleanupOrphanedDocuments: true
   ForceFullReindex: false
   â†’ Incremental sync, database stays current

OPTION 2 - Historical Archive:
   CleanupOrphanedDocuments: false
   ForceFullReindex: false
   â†’ Never delete old data, grows over time

OPTION 3 - Force Complete Refresh:
   CleanupOrphanedDocuments: true
   ForceFullReindex: true  âš ï¸ Temporary!
   â†’ Delete everything, re-index from scratch


NEW REPOSITORY METHODS:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

VectorRepository now includes:

âœ“ CleanupOrphanedDocumentsAsync()
  â†’ Removes deleted files automatically

âœ“ DeleteAllProviderDocumentsAsync()
  â†’ Force complete reset for a provider

âœ“ IsDocumentIndexedAsync()
  â†’ ETag-based change detection

âœ“ UpdateFileTrackingAsync()
  â†’ Track file state after indexing


EXAMPLE RUN OUTPUT:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Day 1 - Initial Index:
INFO: Processing 10 documents from local/LocalFiles
INFO: Processing file: report.docx from LocalFiles
INFO: Processing file: memo.docx from LocalFiles
INFO: Indexing complete. Processed: 10, Skipped: 0, Chunks: 120

Day 2 - Incremental (1 updated, 2 deleted, 7 unchanged):
INFO: Processing 8 documents from local/LocalFiles
INFO: Found 2 orphaned document(s). Cleaning up...
INFO: Deleted orphaned: old-report.docx
INFO: Deleted orphaned: archived.docx
INFO: Cleanup complete: 2 documents removed, 24 chunks deleted
INFO: Skipping unchanged: memo.docx (ETag: sha256:abc...)
INFO: Processing file: report.docx from LocalFiles
INFO: Indexing complete. Processed: 1, Skipped: 7, Chunks: 12


DOCUMENTATION:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“– Full Guide:      docs/guides/file-lifecycle.md
ğŸ“– Quick Reference: docs/guides/file-lifecycle-quickref.md
ğŸ“– Summary:         docs/guides/SUMMARY-FILE-LIFECYCLE.md
ğŸ“– Execution Modes: docs/guides/execution-modes.md


KEY TAKEAWAYS:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… System automatically handles ALL file lifecycle events
âœ… Database stays in sync with document sources
âœ… No manual cleanup needed
âœ… Efficient: skips unchanged files via ETag tracking
âœ… Configurable: choose cleanup behavior for your use case
âœ… Logging: clear visibility into what changed
âœ… Production-ready: no breaking changes, safe defaults
